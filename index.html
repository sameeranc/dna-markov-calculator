<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNA Markov Process Calculator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Ensure the page loads properly */
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        #root { 
            min-height: 100vh; 
        }
        /* Loading indicator */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 18px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">Loading DNA Markov Calculator...</div>
    </div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide React icons as simple SVG components
        const ChevronRight = (props) => React.createElement('svg', {
            ...props,
            width: props.size || 24,
            height: props.size || 24,
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: 2,
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('polyline', { points: '9,18 15,12 9,6' }));
        
        const Play = (props) => React.createElement('svg', {
            ...props,
            width: props.size || 24,
            height: props.size || 24,
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: 2,
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('polygon', { points: '5,3 19,12 5,21' }));
        
        const RotateCcw = (props) => React.createElement('svg', {
            ...props,
            width: props.size || 24,
            height: props.size || 24,
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: 2,
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, 
        React.createElement('polyline', { points: '1,4 1,10 7,10' }),
        React.createElement('path', { d: 'M3.51,15a9,9,0,1,0,2.13-9.36L1,10' }));
        
        const BookOpen = (props) => React.createElement('svg', {
            ...props,
            width: props.size || 24,
            height: props.size || 24,
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: 2,
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        },
        React.createElement('path', { d: 'M2,3h6a4,4,0,0,1,4,4V21a2,2,0,0,0-2-2H2Z' }),
        React.createElement('path', { d: 'M22,3h-6a4,4,0,0,0-4,4V21a2,2,0,0,1,2-2h8Z' }));

        const DNAMarkovDemo = () => {
            const [sequence, setSequence] = useState('ATCG');
            const [currentStep, setCurrentStep] = useState(0);
            const [showCalculations, setShowCalculations] = useState(false);
            const [autoPlay, setAutoPlay] = useState(false);

            // Default prior probabilities
            const [priorProbs, setPriorProbs] = useState({
                A: 0.25,
                T: 0.25,
                C: 0.25,
                G: 0.25
            });

            // Default transition matrix
            const [transitionMatrix, setTransitionMatrix] = useState({
                A: { A: 0.1, T: 0.4, C: 0.3, G: 0.2 },
                T: { A: 0.3, T: 0.1, C: 0.2, G: 0.4 },
                C: { A: 0.2, T: 0.3, C: 0.1, G: 0.4 },
                G: { A: 0.4, T: 0.2, C: 0.3, G: 0.1 }
            });

            const calculateSequenceProbability = () => {
                if (sequence.length === 0) return { total: 0, steps: [] };
                
                const steps = [];
                let totalProb = 1;

                // First nucleotide uses prior probability
                const firstNuc = sequence[0];
                const firstProb = priorProbs[firstNuc] || 0;
                totalProb *= firstProb;
                
                steps.push({
                    position: 0,
                    nucleotide: firstNuc,
                    calculation: `P(${firstNuc}) = ${firstProb}`,
                    probability: firstProb,
                    runningTotal: totalProb,
                    type: 'prior'
                });

                // Subsequent nucleotides use transition probabilities
                for (let i = 1; i < sequence.length; i++) {
                    const prevNuc = sequence[i - 1];
                    const currentNuc = sequence[i];
                    const transProb = transitionMatrix[prevNuc]?.[currentNuc] || 0;
                    totalProb *= transProb;
                    
                    steps.push({
                        position: i,
                        nucleotide: currentNuc,
                        calculation: `P(${currentNuc}|${prevNuc}) = ${transProb}`,
                        probability: transProb,
                        runningTotal: totalProb,
                        type: 'transition'
                    });
                }

                return { total: totalProb, steps };
            };

            const { total: totalProbability, steps } = calculateSequenceProbability();

            useEffect(() => {
                if (autoPlay && currentStep < steps.length) {
                    const timer = setTimeout(() => {
                        setCurrentStep(currentStep + 1);
                    }, 2000);
                    return () => clearTimeout(timer);
                }
            }, [autoPlay, currentStep, steps.length]);

            const reset = () => {
                setCurrentStep(0);
                setAutoPlay(false);
            };

            const handleSequenceChange = (e) => {
                const newSeq = e.target.value.toUpperCase().replace(/[^ATCG]/g, '');
                setSequence(newSeq);
                setCurrentStep(0);
                setAutoPlay(false);
            };

            const updatePrior = (base, value) => {
                setPriorProbs(prev => ({
                    ...prev,
                    [base]: Math.max(0, Math.min(1, parseFloat(value) || 0))
                }));
            };

            const updateTransition = (from, to, value) => {
                setTransitionMatrix(prev => ({
                    ...prev,
                    [from]: {
                        ...prev[from],
                        [to]: Math.max(0, Math.min(1, parseFloat(value) || 0))
                    }
                }));
            };

            return React.createElement('div', { className: "max-w-6xl mx-auto p-6 bg-white" },
                React.createElement('div', { className: "mb-8" },
                    React.createElement('h1', { className: "text-3xl font-bold text-gray-800 mb-4 flex items-center gap-3" },
                        React.createElement(BookOpen, { className: "text-blue-600" }),
                        "DNA Markov Process Calculator"
                    ),
                    React.createElement('p', { className: "text-gray-600 text-lg" },
                        "Learn how Markov processes calculate probabilities for DNA sequences using prior probabilities and transition matrices."
                    )
                ),
                
                React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-8" },
                    // Input Section
                    React.createElement('div', { className: "space-y-6" },
                        React.createElement('div', { className: "bg-blue-50 p-6 rounded-lg" },
                            React.createElement('h2', { className: "text-xl font-semibold mb-4 text-blue-800" }, "DNA Sequence"),
                            React.createElement('input', {
                                type: "text",
                                value: sequence,
                                onChange: handleSequenceChange,
                                placeholder: "Enter DNA sequence (A, T, C, G)",
                                className: "w-full p-3 border-2 border-blue-200 rounded-lg text-lg font-mono tracking-wider focus:border-blue-400 focus:outline-none",
                                maxLength: "20"
                            }),
                            React.createElement('p', { className: "text-sm text-blue-600 mt-2" }, "Only A, T, C, G characters allowed")
                        ),
                        
                        // Prior Probabilities
                        React.createElement('div', { className: "bg-green-50 p-6 rounded-lg" },
                            React.createElement('h2', { className: "text-xl font-semibold mb-4 text-green-800" }, "Prior Probabilities P(X₁)"),
                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                Object.entries(priorProbs).map(([base, prob]) =>
                                    React.createElement('div', { key: base, className: "flex items-center gap-2" },
                                        React.createElement('label', { className: "font-mono font-bold text-lg w-8" }, base + ":"),
                                        React.createElement('input', {
                                            type: "number",
                                            step: "0.01",
                                            min: "0",
                                            max: "1",
                                            value: prob,
                                            onChange: (e) => updatePrior(base, e.target.value),
                                            className: "flex-1 p-2 border border-green-200 rounded focus:border-green-400 focus:outline-none"
                                        })
                                    )
                                )
                            )
                        ),
                        
                        // Transition Matrix
                        React.createElement('div', { className: "bg-purple-50 p-6 rounded-lg" },
                            React.createElement('h2', { className: "text-xl font-semibold mb-4 text-purple-800" }, "Transition Matrix P(Xᵢ|Xᵢ₋₁)"),
                            React.createElement('div', { className: "overflow-x-auto" },
                                React.createElement('table', { className: "w-full border-collapse border border-purple-200" },
                                    React.createElement('thead', {},
                                        React.createElement('tr', {},
                                            React.createElement('th', { className: "border border-purple-200 p-2 bg-purple-100" }, "From \\ To"),
                                            ['A', 'T', 'C', 'G'].map(base =>
                                                React.createElement('th', { key: base, className: "border border-purple-200 p-2 bg-purple-100 font-mono" }, base)
                                            )
                                        )
                                    ),
                                    React.createElement('tbody', {},
                                        Object.entries(transitionMatrix).map(([from, transitions]) =>
                                            React.createElement('tr', { key: from },
                                                React.createElement('th', { className: "border border-purple-200 p-2 bg-purple-100 font-mono" }, from),
                                                Object.entries(transitions).map(([to, prob]) =>
                                                    React.createElement('td', { key: to, className: "border border-purple-200 p-1" },
                                                        React.createElement('input', {
                                                            type: "number",
                                                            step: "0.01",
                                                            min: "0",
                                                            max: "1",
                                                            value: prob,
                                                            onChange: (e) => updateTransition(from, to, e.target.value),
                                                            className: "w-full p-1 text-center border-0 focus:bg-purple-100 focus:outline-none"
                                                        })
                                                    )
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    ),
                    
                    // Calculation Section
                    React.createElement('div', { className: "space-y-6" },
                        React.createElement('div', { className: "bg-gray-50 p-6 rounded-lg" },
                            React.createElement('div', { className: "flex items-center justify-between mb-4" },
                                React.createElement('h2', { className: "text-xl font-semibold text-gray-800" }, "Step-by-Step Calculation"),
                                React.createElement('div', { className: "flex gap-2" },
                                    React.createElement('button', {
                                        onClick: () => setAutoPlay(!autoPlay),
                                        className: "flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",
                                        disabled: currentStep >= steps.length
                                    },
                                        React.createElement(Play, { size: 16 }),
                                        autoPlay ? 'Pause' : 'Auto Play'
                                    ),
                                    React.createElement('button', {
                                        onClick: reset,
                                        className: "flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700"
                                    },
                                        React.createElement(RotateCcw, { size: 16 }),
                                        "Reset"
                                    )
                                )
                            ),
                            
                            // Sequence visualization
                            React.createElement('div', { className: "mb-6 p-4 bg-white rounded-lg border-2 border-gray-200" },
                                React.createElement('h3', { className: "font-semibold mb-3" }, "Sequence: " + sequence),
                                React.createElement('div', { className: "flex items-center gap-2 flex-wrap" },
                                    sequence.split('').map((base, index) =>
                                        React.createElement('div', { key: index, className: "flex items-center" },
                                            React.createElement('div', {
                                                className: `w-12 h-12 rounded-lg flex items-center justify-center font-mono font-bold text-lg border-2 ${
                                                    index <= currentStep - 1 
                                                        ? 'bg-green-100 border-green-400 text-green-800' 
                                                        : 'bg-gray-100 border-gray-300 text-gray-600'
                                                }`
                                            }, base),
                                            index < sequence.length - 1 && React.createElement(ChevronRight, {
                                                className: `mx-1 ${index < currentStep - 1 ? 'text-green-600' : 'text-gray-400'}`,
                                                size: 20
                                            })
                                        )
                                    )
                                )
                            ),
                            
                            // Step calculations
                            React.createElement('div', { className: "space-y-4" },
                                steps.slice(0, currentStep).map((step, index) =>
                                    React.createElement('div', {
                                        key: index,
                                        className: `p-4 rounded-lg border-2 ${
                                            step.type === 'prior' 
                                                ? 'bg-green-50 border-green-200' 
                                                : 'bg-purple-50 border-purple-200'
                                        }`
                                    },
                                        React.createElement('div', { className: "flex justify-between items-center mb-2" },
                                            React.createElement('h4', { className: "font-semibold" },
                                                `Step ${index + 1}: Position ${step.position + 1} - ${step.nucleotide}`
                                            ),
                                            React.createElement('span', {
                                                className: `px-2 py-1 rounded text-xs font-semibold ${
                                                    step.type === 'prior' 
                                                        ? 'bg-green-200 text-green-800' 
                                                        : 'bg-purple-200 text-purple-800'
                                                }`
                                            }, step.type === 'prior' ? 'Prior Probability' : 'Transition Probability')
                                        ),
                                        React.createElement('div', { className: "font-mono text-lg mb-2" }, step.calculation),
                                        React.createElement('div', { className: "text-sm text-gray-600" },
                                            `Running probability: ${step.runningTotal.toFixed(6)}`
                                        )
                                    )
                                ),
                                
                                currentStep > 0 && currentStep < steps.length && React.createElement('button', {
                                    onClick: () => setCurrentStep(currentStep + 1),
                                    className: "w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold"
                                }, "Next Step")
                            ),
                            
                            // Final result
                            currentStep >= steps.length && steps.length > 0 && React.createElement('div', {
                                className: "mt-6 p-6 bg-yellow-50 border-2 border-yellow-200 rounded-lg"
                            },
                                React.createElement('h3', { className: "text-xl font-semibold text-yellow-800 mb-4" }, "Final Result"),
                                React.createElement('div', { className: "space-y-2" },
                                    React.createElement('div', { className: "font-mono text-lg" },
                                        `P(${sequence}) = ${steps.map(s => s.probability).join(' × ')}`
                                    ),
                                    React.createElement('div', { className: "text-2xl font-bold text-yellow-800" },
                                        `P(${sequence}) = ${totalProbability.toFixed(8)}`
                                    ),
                                    React.createElement('div', { className: "text-sm text-yellow-700" },
                                        `This represents the probability of observing the sequence "${sequence}" given our Markov model.`
                                    )
                                )
                            )
                        )
                    )
                ),
                
                // Educational Notes
                React.createElement('div', { className: "mt-8 bg-blue-50 p-6 rounded-lg" },
                    React.createElement('h2', { className: "text-xl font-semibold mb-4 text-blue-800" }, "Key Concepts"),
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6 text-sm" },
                        React.createElement('div', {},
                            React.createElement('h3', { className: "font-semibold mb-2 text-blue-700" }, "Markov Property"),
                            React.createElement('p', { className: "text-blue-600" },
                                "The probability of the next nucleotide depends only on the current nucleotide, not on the entire history of the sequence."
                            )
                        ),
                        React.createElement('div', {},
                            React.createElement('h3', { className: "font-semibold mb-2 text-blue-700" }, "Prior Probabilities"),
                            React.createElement('p', { className: "text-blue-600" },
                                "The probability of observing each nucleotide at the first position, representing the initial distribution."
                            )
                        ),
                        React.createElement('div', {},
                            React.createElement('h3', { className: "font-semibold mb-2 text-blue-700" }, "Transition Matrix"),
                            React.createElement('p', { className: "text-blue-600" },
                                "Shows the probability of transitioning from one nucleotide to another. Each row should sum to 1.0."
                            )
                        ),
                        React.createElement('div', {},
                            React.createElement('h3', { className: "font-semibold mb-2 text-blue-700" }, "Sequence Probability"),
                            React.createElement('p', { className: "text-blue-600" },
                                "Calculated by multiplying the prior probability of the first nucleotide by all subsequent transition probabilities."
                            )
                        )
                    )
                )
            );
        };
        
        // Render the component
        ReactDOM.render(React.createElement(DNAMarkovDemo), document.getElementById('root'));
    </script>
</body>
</html>
